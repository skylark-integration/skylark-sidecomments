/**
 * skylark-sidecomments - A version of side-comments that ported to running on skylarkjs ui.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sidecomments/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx/langx","skylark-jquery","./Section"],function(t,e,i,n){var s=e.Emitter.inherit({_construct:function(t,n,s){this.$el=i(t),this.$body=i("body"),this.eventPipe=new e.Emitter,this.currentUser=e.clone(n)||null,this.existingComments=e.clone(s)||[],this.sections=[],this.activeSection=null,this.eventPipe.on("showComments",e.bind(this.showComments,this)),this.eventPipe.on("hideComments",e.bind(this.hideComments,this)),this.eventPipe.on("sectionSelected",e.bind(this.sectionSelected,this)),this.eventPipe.on("sectionDeselected",e.bind(this.sectionDeselected,this)),this.eventPipe.on("commentPosted",e.bind(this.commentPosted,this)),this.eventPipe.on("commentDeleted",e.bind(this.commentDeleted,this)),this.eventPipe.on("addCommentAttempted",e.bind(this.addCommentAttempted,this)),this.$body.on("click",e.bind(this.bodyClick,this)),this.initialize(this.existingComments)},initialize:function(t){var s=this;e.forEach(this.$el.find(".commentable-section"),function(t){var o=i(t),c=o.data("section-id").toString(),m=e.find(s.existingComments,function(t){return t.sectionId==c});s.sections.push(new n(s.eventPipe,o,s.currentUser,m))})},showComments:function(){this.$el.addClass("side-comments-open")},hideComments:function(){this.activeSection&&(this.activeSection.deselect(),this.activeSection=null),this.$el.removeClass("side-comments-open")},sectionSelected:function(t,e){this.showComments(),this.activeSection&&this.activeSection.deselect(),this.activeSection=e},sectionDeselected:function(t,e){this.hideComments(),this.activeSection=null},commentPosted:function(t,e){this.emit("commentPosted",e)},commentDeleted:function(t,e){this.emit("commentDeleted",e)},addCommentAttempted:function(){this.emit("addCommentAttempted")},insertComment:function(t){e.find(this.sections,function(e){return e.id==t.sectionId}).insertComment(t)},removeComment:function(t,i){e.find(this.sections,function(e){return e.id==t}).removeComment(i)},deleteComment:function(t,i){e.find(this.sections,function(e){return e.id==t}).deleteComment(i)},commentsAreVisible:function(){return this.$el.hasClass("side-comments-open")},bodyClick:function(t){var e=i(t.target);e.closest(".side-comment").length<1&&e.closest("body").length>0&&(this.activeSection&&this.activeSection.deselect(),this.hideComments())},setCurrentUser:function(t){this.hideComments(),this.currentUser=t,e.forEach(this.sections,function(t){t.currentUser=this.currentUser,t.render()})},removeCurrentUser:function(){this.hideComments(),this.currentUser=null,e.forEach(this.sections,function(t){t.currentUser=null,t.render()})},destroy:function(){this.hideComments(),this.$el.off()}});return t.attach("intg.SlideComments",s)});
//# sourceMappingURL=sourcemaps/SideComments.js.map
