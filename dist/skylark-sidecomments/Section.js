/**
 * skylark-sidecomments - A version of side-comments that ported to running on skylarkjs ui.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-sidecomments/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-jquery","../templates/section.html","./templates/comment.html","./helpers/mobile-check"],function(t,e,n,i,o){function s(e,n,i,s){this.eventPipe=e,this.$el=n,this.comments=s?s.comments:[],this.currentUser=i||null,this.clickEventName=o()?"touchstart":"click",this.id=n.data("section-id"),this.$el.on(this.clickEventName,".side-comment .marker",t.proxy(this.markerClick,this)),this.$el.on(this.clickEventName,".side-comment .add-comment",t.proxy(this.addCommentClick,this)),this.$el.on(this.clickEventName,".side-comment .post",t.proxy(this.postCommentClick,this)),this.$el.on(this.clickEventName,".side-comment .cancel",t.proxy(this.cancelCommentClick,this)),this.$el.on(this.clickEventName,".side-comment .delete",t.proxy(this.deleteCommentClick,this)),this.render()}return s.prototype.markerClick=function(t){t.preventDefault(),this.select()},s.prototype.addCommentClick=function(t){t.preventDefault(),this.currentUser?this.showCommentForm():this.eventPipe.emit("addCommentAttempted")},s.prototype.showCommentForm=function(){this.comments.length>0&&(this.$el.find(".add-comment").addClass("hide"),this.$el.find(".comment-form").addClass("active")),this.focusCommentBox()},s.prototype.hideCommentForm=function(){this.comments.length>0&&(this.$el.find(".add-comment").removeClass("hide"),this.$el.find(".comment-form").removeClass("active")),this.$el.find(".comment-box").empty()},s.prototype.focusCommentBox=function(){setTimeout(t.proxy(function(){this.$el.find(".comment-box").get(0).focus()},this),300)},s.prototype.cancelCommentClick=function(t){t.preventDefault(),this.cancelComment()},s.prototype.cancelComment=function(){this.comments.length>0?this.hideCommentForm():(this.deselect(),this.eventPipe.emit("hideComments"))},s.prototype.postCommentClick=function(t){t.preventDefault(),this.postComment()},s.prototype.postComment=function(){var t=this.$el.find(".comment-box"),e=t.val(),n={sectionId:this.id,comment:e,authorAvatarUrl:this.currentUser.avatarUrl,authorName:this.currentUser.name,authorId:this.currentUser.id,authorUrl:this.currentUser.authorUrl||null};t.val(""),this.eventPipe.emit("commentPosted",n)},s.prototype.insertComment=function(e){this.comments.push(e);var n=t.template(i)({comment:e,currentUser:this.currentUser});this.$el.find(".comments").append(n),this.$el.find(".side-comment").addClass("has-comments"),this.updateCommentCount(),this.hideCommentForm()},s.prototype.updateCommentCount=function(){this.$el.find(".marker span").text(this.comments.length)},s.prototype.deleteCommentClick=function(t){t.preventDefault();var n=e(t.target).closest("li").data("comment-id");window.confirm("Are you sure you want to delete this comment?")&&this.deleteComment(n)},s.prototype.deleteComment=function(e){var n=t.find(this.comments,function(t){return t.id==e});n.sectionId=this.id,this.eventPipe.emit("commentDeleted",n)},s.prototype.removeComment=function(e){this.comments=t.filter(this.comments,function(t){return t.id!=e}),this.$el.find('.side-comment .comments li[data-comment-id="'+e+'"]').remove(),this.updateCommentCount(),this.comments.length<1&&this.$el.find(".side-comment").removeClass("has-comments")},s.prototype.select=function(){this.isSelected()?(this.deselect(),this.eventPipe.emit("sectionDeselected",this)):(this.$el.find(".side-comment").addClass("active"),0===this.comments.length&&this.currentUser&&this.focusCommentBox(),this.eventPipe.emit("sectionSelected",this))},s.prototype.deselect=function(){this.$el.find(".side-comment").removeClass("active"),this.hideCommentForm()},s.prototype.isSelected=function(){return this.$el.find(".side-comment").hasClass("active")},s.prototype.sectionClasses=function(){var t="";return this.comments.length>0&&(t+=" has-comments"),this.currentUser||(t+=" no-current-user"),t},s.prototype.render=function(){this.$el.find(".side-comment").remove(),e(t.template(n,{commentTemplate:i,comments:this.comments,sectionClasses:this.sectionClasses(),currentUser:this.currentUser})).appendTo(this.$el)},s.prototype.destroy=function(){this.$el.off()},s});
//# sourceMappingURL=sourcemaps/Section.js.map
